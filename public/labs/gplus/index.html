<!doctype html>
<html>
	<head>
		<meta name="google-signin-clientid" content="1045985444734-ftbaim9oemu66fkii1tmjemnrghermtd.apps.googleusercontent.com" />
		<meta name="google-signin-scope" content="https://www.googleapis.com/auth/plus.login" />
		<meta name="google-signin-requestvisibleactions" content="http://schemas.google.com/AddActivity" />
		<meta name="google-signin-cookiepolicy" content="single_host_origin" />		
	</head>
	<body>
		<!-- Place this asynchronous JavaScript just before your </body> tag -->
		<button id="signinButton">Sign in with Google</button>
		<script type="text/javascript">
			(function() {
				var po = document.createElement('script');
				po.type = 'text/javascript'; po.async = true;
				po.src = 'https://apis.google.com/js/client:plusone.js?onload=render';
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(po, s);
			})();

			/* Executed when the APIs finish loading */
			function render() {
				// Additional params including the callback, the rest of the params will
				// come from the page-level configuration.
				var additionalParams = {
					'callback': signinCallback
				};
				
				// Attach a click listener to a button to trigger the flow.
				var signinButton = document.getElementById('signinButton');
				signinButton.addEventListener('click', function() {
					gapi.auth.signIn(additionalParams); // Will use page level configuration
				});
			}

			function signinCallback(authResult) {
				if (authResult['status']['signed_in']) {
					gapi.client.load('plus','v1', function(){
						var payload = {
							"target": {
								"id" : getHash("palmeiras"),
								"image" : "http:\/\/palmeiras.com.br\/images\/escudo.png",
								"type" : "http:\/\/schema.org\/CreativeWork",
								"description" : "E dalhe dalhe porcooooooooo",
								"name":"Sociedade Esportiva Palmeiras"
							},
							"type":"http:\/\/schemas.google.com\/AddActivity",
						};
						gapi.client.plus.moments.insert(
							{  
								'userId' : 'me',
								'collection' : 'vault',
								'resource' : payload
							}).execute(function(result){
								console.log(result);
						});
					});

				} else {
					// Update the app to reflect a signed out user
					// Possible error values:
					//   "user_signed_out" - User is signed-out
					//   "access_denied" - User denied access to your app
					//   "immediate_failed" - Could not automatically log in the user
					console.log('Sign-in state: ' + authResult['error']);
				}
			}

			function getHash( string ){
				var hash = 0, i, char;
				if (string.length == 0) return hash;
				for (i = 0, l = string.length; i < l; i++) {
					char  = string.charCodeAt(i);
					hash  = ((hash<<5)-hash)+char;
					hash |= 0; // Convert to 32bit integer
				}
				return hash;
			}
		</script>
	</body>
</html>